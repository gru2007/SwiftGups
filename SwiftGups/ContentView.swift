import SwiftUI

struct ContentView: View {
    @StateObject private var scheduleService: ScheduleService
    @State private var searchText = ""
    @State private var showDatePicker = false
    let showUserInfo: Bool
    
    init(scheduleService: ScheduleService? = nil, showUserInfo: Bool = true) {
        self._scheduleService = StateObject(wrappedValue: scheduleService ?? ScheduleService())
        self.showUserInfo = showUserInfo
    }

    var body: some View {
        NavigationView {
            ScrollView {
                VStack(spacing: 20) {
                    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ (—Ç–æ–ª—å–∫–æ –¥–ª—è standalone –≤–µ—Ä—Å–∏–∏)
                    if showUserInfo {
                        HeaderView()
                    }
                    
                    // –í—ã–±–æ—Ä —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞
                    if showUserInfo {
                        FacultySelectionView(scheduleService: scheduleService)
                    }
                    
                    // –í—ã–±–æ—Ä –¥–∞—Ç—ã
                    DateSelectionView(scheduleService: scheduleService, showDatePicker: $showDatePicker)
                    
                    // –ü–æ–∏—Å–∫ –∏ –≤—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã
                    if scheduleService.selectedFaculty != nil && showUserInfo {
                        GroupSelectionView(scheduleService: scheduleService, searchText: $searchText)
                    }
                    
                    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
                    ScheduleDisplayView(scheduleService: scheduleService)
                    
                    Spacer()
                }
                .padding()
            }
            .navigationTitle("SwiftGups")
            .navigationBarTitleDisplayMode(.large)
            .refreshable {
                await scheduleService.refresh()
            }
            .sheet(isPresented: $showDatePicker) {
                DatePickerSheet(selectedDate: $scheduleService.selectedDate) {
                    scheduleService.selectDate(scheduleService.selectedDate)
                }
            }
        }
        .task {
            if scheduleService.selectedFaculty != nil {
                await scheduleService.loadGroups()
            }
        }
    }
}

// MARK: - Header View

struct HeaderView: View {
    var body: some View {
        VStack(spacing: 8) {
            Text("üéì")
                .font(.system(size: 50))
            
            Text("–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –î–í–ì–£–ü–°")
                .font(.title2)
                .fontWeight(.semibold)
                .multilineTextAlignment(.center)
            
            Text("–£–¥–æ–±–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∑–∞–Ω—è—Ç–∏–π")
                .font(.caption)
                .foregroundColor(.secondary)
                .multilineTextAlignment(.center)
        }
        .padding()
        .background(
            RoundedRectangle(cornerRadius: 16)
                .fill(Color(.systemBackground))
                .shadow(color: .black.opacity(0.1), radius: 5, x: 0, y: 2)
        )
    }
}

// MARK: - Faculty Selection View

struct FacultySelectionView: View {
    @ObservedObject var scheduleService: ScheduleService

    var body: some View {
        VStack(alignment: .leading, spacing: 12) {
            Label("–ò–Ω—Å—Ç–∏—Ç—É—Ç/–§–∞–∫—É–ª—å—Ç–µ—Ç", systemImage: "building.2")
                .font(.headline)
                .foregroundColor(.primary)
            
            Menu {
                ForEach(scheduleService.faculties) { faculty in
                    Button(action: {
                        scheduleService.selectFaculty(faculty)
                    }) {
                        HStack {
                            Text(faculty.name)
                            if scheduleService.selectedFaculty?.id == faculty.id {
                                Spacer()
                                Image(systemName: "checkmark")
                            }
                        }
                    }
                }
            } label: {
                HStack {
                    Text(scheduleService.selectedFaculty?.name ?? "–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç–∏—Ç—É—Ç/—Ñ–∞–∫—É–ª—å—Ç–µ—Ç")
                        .foregroundColor(scheduleService.selectedFaculty != nil ? .primary : .secondary)
                    
                    Spacer()
                    
                    Image(systemName: "chevron.down")
                        .foregroundColor(.secondary)
                }
                .padding()
                .background(
                    RoundedRectangle(cornerRadius: 12)
                        .fill(Color(.systemGray6))
                        .stroke(Color(.systemGray4), lineWidth: 1)
                )
            }
        }
        .padding()
        .background(
            RoundedRectangle(cornerRadius: 16)
                .fill(Color(.systemBackground))
                .shadow(color: .black.opacity(0.1), radius: 5, x: 0, y: 2)
        )
    }
}

// MARK: - Date Selection View

struct DateSelectionView: View {
    @ObservedObject var scheduleService: ScheduleService
    @Binding var showDatePicker: Bool
    
    var body: some View {
        VStack(alignment: .leading, spacing: 12) {
            Label("–ù–µ–¥–µ–ª—è", systemImage: "calendar")
                .font(.headline)
                .foregroundColor(.primary)
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º
            HStack(spacing: 12) {
                // –ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è
                Button(action: {
                    scheduleService.previousWeek()
                }) {
                    Image(systemName: "chevron.left")
                        .font(.title3)
                        .foregroundColor(.blue)
                }
                
                Spacer()
                
                // –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è
                VStack(spacing: 4) {
                    Text(scheduleService.currentWeekRange())
                        .font(.headline)
                        .foregroundColor(.primary)
                    
                    Button("–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è") {
                        scheduleService.goToCurrentWeek()
                    }
                    .font(.caption)
                    .foregroundColor(.blue)
                }
                
                Spacer()
                
                // –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è
                Button(action: {
                    scheduleService.nextWeek()
                }) {
                    Image(systemName: "chevron.right")
                        .font(.title3)
                        .foregroundColor(.blue)
                }
            }
            .padding()
            .background(
                RoundedRectangle(cornerRadius: 12)
                    .fill(Color(.systemGray6))
                    .stroke(Color(.systemGray4), lineWidth: 1)
            )
            
            // –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã
            Button(action: {
                showDatePicker = true
            }) {
                HStack {
                    Image(systemName: "calendar.badge.plus")
                        .foregroundColor(.blue)
                    
                    Text("–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É")
                        .foregroundColor(.primary)
                    
                    Spacer()
                }
                .padding()
                .background(
                    RoundedRectangle(cornerRadius: 12)
                        .fill(Color(.systemGray6))
                        .stroke(Color(.systemGray4), lineWidth: 1)
                )
            }
        }
        .padding()
        .background(
            RoundedRectangle(cornerRadius: 16)
                .fill(Color(.systemBackground))
                .shadow(color: .black.opacity(0.1), radius: 5, x: 0, y: 2)
        )
    }
}

// MARK: - Group Selection View

struct GroupSelectionView: View {
    @ObservedObject var scheduleService: ScheduleService
    @Binding var searchText: String
    
    private var filteredGroups: [Group] {
        scheduleService.filteredGroups(searchText: searchText)
    }
    
    var body: some View {
        VStack(alignment: .leading, spacing: 12) {
            Label("–ì—Ä—É–ø–ø–∞", systemImage: "person.3")
                .font(.headline)
                .foregroundColor(.primary)
            
            // –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞
            HStack {
                Image(systemName: "magnifyingglass")
                    .foregroundColor(.secondary)
                
                TextField("–ü–æ–∏—Å–∫ –≥—Ä—É–ø–ø—ã...", text: $searchText)
                    .textFieldStyle(RoundedBorderTextFieldStyle())
                
                if !searchText.isEmpty {
                    Button("–û—á–∏—Å—Ç–∏—Ç—å") {
                        searchText = ""
                    }
                    .font(.caption)
                    .foregroundColor(.blue)
                }
            }
            .padding(.horizontal)
            
            if scheduleService.isLoading {
                HStack {
                    Spacer()
                    ProgressView("–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø...")
                        .progressViewStyle(CircularProgressViewStyle())
                    Spacer()
                }
                .padding()
            } else if filteredGroups.isEmpty && scheduleService.selectedFaculty != nil {
                Text("–ì—Ä—É–ø–ø—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                    .foregroundColor(.secondary)
                    .frame(maxWidth: .infinity, alignment: .center)
                    .padding()
            } else {
                ScrollView(.horizontal, showsIndicators: false) {
                    LazyHStack(spacing: 12) {
                        ForEach(filteredGroups) { group in
                            GroupCard(
                                group: group,
                                isSelected: scheduleService.selectedGroup?.id == group.id
                            ) {
                                scheduleService.selectGroup(group)
                                searchText = "" // –û—á–∏—â–∞–µ–º –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
                            }
                        }
                    }
                    .padding(.horizontal)
                }
            }
        }
        .padding()
        .background(
            RoundedRectangle(cornerRadius: 16)
                .fill(Color(.systemBackground))
                .shadow(color: .black.opacity(0.1), radius: 5, x: 0, y: 2)
        )
    }
}

// MARK: - Group Card

struct GroupCard: View {
    let group: Group
    let isSelected: Bool
    let action: () -> Void
    
    var body: some View {
        Button(action: action) {
            VStack(alignment: .leading, spacing: 8) {
                Text(group.name)
                    .font(.headline)
                    .fontWeight(.semibold)
                    .foregroundColor(isSelected ? .white : .primary)
                
                Text(group.fullName)
                    .font(.caption)
                    .foregroundColor(isSelected ? .white.opacity(0.8) : .secondary)
                    .multilineTextAlignment(.leading)
                    .lineLimit(2)
            }
            .padding()
            .frame(width: 180, height: 80)
            .background(
                RoundedRectangle(cornerRadius: 12)
                    .fill(isSelected ? Color.blue : Color(.systemGray6))
            )
        }
    }
}

// MARK: - Schedule Display View

struct ScheduleDisplayView: View {
    @ObservedObject var scheduleService: ScheduleService
    
    var body: some View {
        VStack(alignment: .leading, spacing: 16) {
            if let errorMessage = scheduleService.errorMessage {
                ErrorView(message: errorMessage) {
                    scheduleService.errorMessage = nil
                }
            }
            
            if scheduleService.isLoading {
                LoadingView()
            } else if let schedule = scheduleService.currentSchedule {
                ScheduleView(schedule: schedule)
            } else if scheduleService.selectedGroup != nil {
                EmptyScheduleView()
            }
        }
    }
}

// MARK: - Error View

struct ErrorView: View {
    let message: String
    let dismissAction: () -> Void
    
    var body: some View {
        HStack {
            Image(systemName: "exclamationmark.triangle")
                .foregroundColor(.red)
            
            Text(message)
                .font(.subheadline)
                .foregroundColor(.red)
            
            Spacer()
            
            Button("OK", action: dismissAction)
                .font(.caption)
                .foregroundColor(.blue)
        }
        .padding()
        .background(
            RoundedRectangle(cornerRadius: 12)
                .fill(Color.red.opacity(0.1))
                .stroke(Color.red.opacity(0.3), lineWidth: 1)
        )
    }
}

// MARK: - Loading View

struct LoadingView: View {
    var body: some View {
        HStack {
            Spacer()
            VStack(spacing: 12) {
                ProgressView()
                    .progressViewStyle(CircularProgressViewStyle())
                    .scaleEffect(1.2)
                
                Text("–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...")
                    .font(.subheadline)
                    .foregroundColor(.secondary)
            }
            Spacer()
        }
        .padding(40)
    }
}

// MARK: - Empty Schedule View

struct EmptyScheduleView: View {
    var body: some View {
        VStack(spacing: 16) {
            Image(systemName: "calendar.badge.exclamationmark")
                .font(.system(size: 50))
                .foregroundColor(.gray)
            
            Text("–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
                .font(.headline)
                .foregroundColor(.secondary)
            
            Text("–ù–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")
                .font(.subheadline)
                .foregroundColor(.secondary)
                .multilineTextAlignment(.center)
        }
        .padding(40)
        .background(
            RoundedRectangle(cornerRadius: 16)
                .fill(Color(.systemGray6))
        )
    }
}

// MARK: - Schedule View

struct ScheduleView: View {
    let schedule: Schedule
    
    var body: some View {
        VStack(alignment: .leading, spacing: 16) {
            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            VStack(alignment: .leading, spacing: 8) {
                Text("–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ")
                    .font(.title2)
                    .fontWeight(.bold)
                
                Text(schedule.groupName)
                    .font(.headline)
                    .foregroundColor(.blue)
                
                Text("–ü–µ—Ä–∏–æ–¥: \(DateFormatter.displayDateFormatter.string(from: schedule.startDate)) - \(DateFormatter.displayDateFormatter.string(from: schedule.endDate))")
                    .font(.caption)
                    .foregroundColor(.secondary)
            }
            
            // –î–Ω–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            if schedule.days.isEmpty {
                EmptyScheduleView()
            } else {
                LazyVStack(spacing: 16) {
                    ForEach(schedule.days) { day in
                        ScheduleDayView(day: day)
                    }
                }
            }
        }
        .padding()
        .background(
            RoundedRectangle(cornerRadius: 16)
                .fill(Color(.systemBackground))
                .shadow(color: .black.opacity(0.1), radius: 5, x: 0, y: 2)
        )
    }
}

// MARK: - Schedule Day View

struct ScheduleDayView: View {
    let day: ScheduleDay
    
    var body: some View {
        VStack(alignment: .leading, spacing: 12) {
            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–Ω—è
            HStack {
                VStack(alignment: .leading, spacing: 4) {
                    Text(day.weekday)
                        .font(.headline)
                        .fontWeight(.semibold)
                    
                    Text(DateFormatter.apiDateFormatter.string(from: day.date))
                        .font(.subheadline)
                        .foregroundColor(.secondary)
                }
                
                Spacer()
                
                if let weekNumber = day.weekNumber {
                    Text("\(weekNumber)-—è –Ω–µ–¥–µ–ª—è")
                        .font(.caption)
                        .padding(.horizontal, 8)
                        .padding(.vertical, 4)
                        .background(
                            RoundedRectangle(cornerRadius: 6)
                                .fill((day.isEvenWeek ?? false) ? Color.green.opacity(0.2) : Color.orange.opacity(0.2))
                        )
                        .foregroundColor((day.isEvenWeek ?? false) ? .green : .orange)
                }
            }
            
            // –ó–∞–Ω—è—Ç–∏—è
            if day.lessons.isEmpty {
                Text("–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π")
                    .font(.subheadline)
                    .foregroundColor(.secondary)
                    .padding()
            } else {
                LazyVStack(spacing: 8) {
                    ForEach(day.lessons) { lesson in
                        LessonView(lesson: lesson)
                    }
                }
            }
        }
        .padding()
        .background(
            RoundedRectangle(cornerRadius: 12)
                .fill(Color(.systemGray6))
        )
    }
}

// MARK: - Lesson View

struct LessonView: View {
    let lesson: Lesson
    
    private var lessonTypeColor: Color {
        switch lesson.type {
        case .lecture:
            return .blue
        case .practice:
            return .green
        case .laboratory:
            return .orange
        case .unknown:
            return .gray
        }
    }
    
    var body: some View {
        HStack(alignment: .top, spacing: 12) {
            // –ù–æ–º–µ—Ä –ø–∞—Ä—ã –∏ –≤—Ä–µ–º—è
            VStack(alignment: .leading, spacing: 2) {
                Text("\(lesson.pairNumber) –ø–∞—Ä–∞")
                    .font(.caption)
                    .fontWeight(.semibold)
                    .foregroundColor(lessonTypeColor)
                
                Text("\(lesson.timeStart)-\(lesson.timeEnd)")
                    .font(.caption2)
                    .foregroundColor(.secondary)
            }
            .frame(width: 60, alignment: .leading)
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–Ω—è—Ç–∏–∏
            VStack(alignment: .leading, spacing: 4) {
                // –ü—Ä–µ–¥–º–µ—Ç
                if lesson.subject.containsURL {
                    ClickableLinkText(text: lesson.subject)
                        .font(.subheadline)
                        .fontWeight(.medium)
                        .lineLimit(2)
                } else {
                    Text(lesson.subject)
                        .font(.subheadline)
                        .fontWeight(.medium)
                        .lineLimit(2)
                }
                
                // –¢–∏–ø –∑–∞–Ω—è—Ç–∏—è
                Text(lesson.type.rawValue)
                    .font(.caption)
                    .padding(.horizontal, 6)
                    .padding(.vertical, 2)
                    .background(
                        RoundedRectangle(cornerRadius: 4)
                            .fill(lessonTypeColor.opacity(0.2))
                    )
                    .foregroundColor(lessonTypeColor)
                
                // –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
                if let teacher = lesson.teacher, !teacher.name.isEmpty {
                    HStack(spacing: 4) {
                        if teacher.name.containsURL {
                            // –ï—Å–ª–∏ –∏–º—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É
                            ClickableLinkText(text: teacher.name)
                                .font(.caption)
                        } else {
                            Text(teacher.name)
                                .font(.caption)
                                .foregroundColor(.secondary)
                        }
                        
                        if let email = teacher.email, !email.isEmpty {
                            Link("‚úâÔ∏è", destination: URL(string: "mailto:\(email)") ?? URL(string: "about:blank")!)
                                .font(.caption2)
                        }
                    }
                }
                
                // –ê—É–¥–∏—Ç–æ—Ä–∏—è
                if let room = lesson.room, !room.isEmpty {
                    if room.containsURL {
                        ClickableLinkText(text: "üìç \(room)")
                            .font(.caption)
                    } else {
                        Text("üìç \(room)")
                            .font(.caption)
                            .foregroundColor(.secondary)
                    }
                }
                
                // –û–Ω–ª–∞–π–Ω –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                if let onlineLink = lesson.onlineLink, !onlineLink.isEmpty {
                    if onlineLink.containsURL {
                        ClickableLinkText(text: "üíª \(onlineLink)")
                            .font(.caption)
                    } else {
                        Text("üíª \(onlineLink)")
                            .font(.caption)
                            .foregroundColor(.blue)
                    }
                }
            }
            
            Spacer()
        }
        .padding()
        .background(
            RoundedRectangle(cornerRadius: 8)
                .fill(Color(.systemBackground))
                .shadow(color: .black.opacity(0.05), radius: 2, x: 0, y: 1)
        )
    }
}

// MARK: - Date Picker Sheet

struct DatePickerSheet: View {
    @Binding var selectedDate: Date
    let onDateSelected: () -> Void
    @Environment(\.dismiss) private var dismiss
    
    var body: some View {
        NavigationView {
            VStack(spacing: 20) {
                Text("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É")
                    .font(.title2)
                    .fontWeight(.semibold)
                    .padding(.top)
                
                DatePicker(
                    "–î–∞—Ç–∞",
                    selection: $selectedDate,
                    displayedComponents: [.date]
                )
                .datePickerStyle(GraphicalDatePickerStyle())
                .padding()
                
                Spacer()
            }
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .navigationBarLeading) {
                    Button("–û—Ç–º–µ–Ω–∞") {
                        dismiss()
                    }
                }
                
                ToolbarItem(placement: .navigationBarTrailing) {
                    Button("–ì–æ—Ç–æ–≤–æ") {
                        onDateSelected()
                        dismiss()
                    }
                    .fontWeight(.semibold)
                }
            }
        }
        .presentationDetents([.medium, .large])
    }
}

// MARK: - Clickable Link Text Component

struct ClickableLinkText: View {
    let text: String
    
    var body: some View {
        let urls = text.extractedURLs
        
        if urls.isEmpty {
            // –ï—Å–ª–∏ –Ω–µ—Ç URL, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
            Text(text)
                .foregroundColor(.secondary)
        } else if urls.count == 1, let url = urls.first, text.trimmingCharacters(in: .whitespacesAndNewlines) == url.absoluteString {
            // –ï—Å–ª–∏ –≤–µ—Å—å —Ç–µ–∫—Å—Ç - —ç—Ç–æ –æ–¥–Ω–∞ —Å—Å—ã–ª–∫–∞
            Link(text, destination: url)
                .foregroundColor(.blue)
        } else {
            // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫–∏ —Å—Ä–µ–¥–∏ –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            HStack(alignment: .top, spacing: 4) {
                // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —á–∞—Å—Ç–∏ –∏ —Å–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Å—Å—ã–ª–æ–∫ –∏ —Ç–µ–∫—Å—Ç–∞
                let parts = parseTextWithLinks(text)
                ForEach(Array(parts.enumerated()), id: \.offset) { _, part in
                    if let url = URL(string: part), urls.contains(where: { $0.absoluteString == part }) {
                        Link(part, destination: url)
                            .foregroundColor(.blue)
                            .underline()
                    } else {
                        Text(part)
                            .foregroundColor(.secondary)
                    }
                }
            }
        }
    }
    
    private func parseTextWithLinks(_ text: String) -> [String] {
        let urls = text.extractedURLs.map { $0.absoluteString }
        var result: [String] = []
        var remainingText = text
        
        for url in urls {
            let components = remainingText.components(separatedBy: url)
            if let first = components.first {
                if !first.isEmpty {
                    result.append(first)
                }
                result.append(url)
                remainingText = components.dropFirst().joined(separator: url)
            }
        }
        
        if !remainingText.isEmpty {
            result.append(remainingText)
        }
        
        return result.filter { !$0.isEmpty }
    }
}

// MARK: - Preview

#Preview {
    ContentView()
}